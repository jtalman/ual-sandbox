!AUL 03/23/03 
title, "Relativistic Heavy Ion Collider"
!
! -------- Protons at top energy
 beam, mass = 0.93827, charge = 1, gamma = 268.2, exn = 20.0e-06, &
       eyn = 20.0e-06, sigt = 0.14
!
! -------- The lattice file from the data base
!    Thin snakes inserted
option, -echo
call, filename = "/rap/Holy_Lattice/Yellow/MAD8_lat.asc"

RHIC :line=(YELLOW)
!  Qx = 28.19   Qy = 29.18      Split tunes
!
! -------- Gradients are set with:
call, filename = "/rap/Holy_Lattice/set/rhic.set"
!
! -------- Utility subroutines, setting tunes, chromaticities, etc

call, filename = "/rap/Holy_Lattice/madfiles/rhic_utilities.mad"

!option, echo
!
!   Setting up the quadrupole strengths (must be done in this order)
!
! -------- 6 O'clock
strength10
set6oc
!
! -------- 8 O'clock
strength10
set8oc
!
! -------- 10 O'clock
strength10
set10oc
!
! -------- 12 O'clock
strength10
set12oc
!
! -------- 2 O'clock
strength10
set2oc
!
! -------- 4 O'clock
strength10
set4oc
!
set, Qx, 28.22
set, Qy, 29.23
setarcquads

! -------- Set the chromaticity.
chromX := 2.0
chromY := 2.0
setchrom

!===================================
!-------- Measured alignment errors
!vertical monitors moved to y=0 centerline 
!ymon := 0
!ysn9 := 0
use, rhic
!call, filename = 'align_err.dat'
!call, filename = 'monitor_shift.dat'
!call, filename = 'xmonitor_shift1.dat'
!call, filename = 'kick_off.dat'
!call, filename = 'mon_off.dat'
!call, filename = 'mon.dat'
!===================================

! -------- Get the transfer matrix for the roman pot.

!use, rhic
!-----------------------------
!   print, full
!   survey, theta0 = ALPHA
!   twiss
! VALUE, VALUE = KD, KF, SD0, SF0
!
! -------- Get the strengths.
! option, -echo
! call, filename = "/rap/Holy_Lattice/Yellow/StrengthsScript.asc"
! option, echo
setopts, echo

!correct, error = 3.e-8, iterate = 10 , c2list, m1list ,m2list

select, flag=FIRST, range =#S/#E
   
print, RHIC
   
twiss, tape='test.twiss'

!select, error ,range=#S/#E
!eprint,range=#S/#E

stop

!
! -------- Show the lattice.

use, rhic
!select, flag=FIRST, range =#S/#E
   TWISS, tape='test.twiss'
STOP
   SELECT, OPTICS, RANGE = #S/QF[2]
   SPLIT, RANGE = #S/QF[2], FRACTION = 0.2
   SPLIT, RANGE = #S/QF[2], FRACTION = 0.4
   SPLIT, RANGE = #S/QF[2], FRACTION = 0.6
   SPLIT, RANGE = #S/QF[2], FRACTION = 0.8
   OPTICS, FILENAME = "rhyellowhalf.optics",&
        COLUMNS = NAME, KEYWORD, S, L, K1L, BETX, DX, BETY, DY
use, rhic
!select, flag=FIRST, range =#S/#E
   SELECT, OPTICS, RANGE = Y10/Y09
   SPLIT, RANGE = Y10/Y09, FRACTION = 0.2
   SPLIT, RANGE = Y10/Y09, FRACTION = 0.4
   SPLIT, RANGE = Y10/Y09, FRACTION = 0.6
   SPLIT, RANGE = Y10/Y09, FRACTION = 0.8
   OPTICS, FILENAME = "rhyellow.optics",&
        COLUMNS = NAME, KEYWORD, S, L, K1L, BETX, DX, BETY, DY
use, rhic
!select, flag=FIRST, range =#S/#E
!select, flag=PRINT, range=#S/#E  
   SELECT, OPTICS, RANGE = #S/#E
   SPLIT, RANGE = #S/#E, FRACTION = 0.2
   SPLIT, RANGE = #S/#E, FRACTION = 0.4
   SPLIT, RANGE = #S/#E, FRACTION = 0.6
   SPLIT, RANGE = #S/#E, FRACTION = 0.8
   OPTICS, FILENAME = "rhyellowfull.optics", DELTAP = 0.000854 &
        COLUMNS = NAME, KEYWORD, S, L, K1L, BETX, DX, BETY, DY
   PRINT, FULL
   TWISS, tape='test.twiss'
STOP
